<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explainable AI - Student Performance Predictor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --border-color: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .header {
            text-align: center;
            padding: 2rem 0;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--bg-primary);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-header i {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-right: 0.75rem;
        }

        .card-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .required {
            color: var(--error-color);
            font-weight: bold;
        }

        .optional {
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: normal;
            font-style: italic;
        }

        .field-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .field-description small {
            color: var(--primary-color);
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s ease;
            background: var(--bg-primary);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            width: 100%;
            margin-top: 1rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }

        .btn i {
            margin-right: 0.5rem;
        }

        .prediction-result {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-top: 2rem;
            animation: slideInUp 0.5s ease-out;
        }

        .prediction-result.excellent { background: linear-gradient(135deg, #10b981, #059669); }
        .prediction-result.good { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .prediction-result.average { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .prediction-result.below-average { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .prediction-result.poor { background: linear-gradient(135deg, #991b1b, #7f1d1d); }

        .prediction-score {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .prediction-category {
            font-size: 1.25rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .insights {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .insights h3 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .insight-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .insight-item:last-child {
            border-bottom: none;
        }

        .explanation-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .plot-container {
            text-align: center;
        }

        .plot-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .shap-summary {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .shap-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .shap-item:last-child {
            border-bottom: none;
        }

        .shap-feature {
            font-weight: 500;
            flex-grow: 1;
        }

        .shap-value {
            font-weight: 600;
            margin-left: 1rem;
        }

        .shap-value.positive { color: var(--success-color); }
        .shap-value.negative { color: var(--error-color); }
        .shap-value.neutral { color: var(--text-secondary); }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
            color: var(--primary-color);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-card h3 {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .info-card p {
            opacity: 0.9;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .grid, .explanation-section {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .prediction-score {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1> Explainable ML Model For Predicting Student Academic Performance</h1>
            <p>Understanding how Machine Learning predicts student outcomes through transparent explanations</p>
        </div>
    </div>

    <div class="container">
        {% if not prediction %}
        <div class="info-card">
            <h3><i class="fas fa-lightbulb"></i> About This System</h3>
            <p>This explainable AI system predicts student performance and provides detailed explanations of how each factor contributes to the prediction. The system uses SHAP (SHapley Additive exPlanations) to make ML decisions transparent and interpretable.</p>
        </div>
        {% endif %}

        <div class="grid">
            <!-- Input Form -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-edit"></i>
                    <h2>Student Information</h2>
                </div>
                <form method="POST" action="/predict" id="predictionForm">
                    {% for feature in features %}
                    <div class="form-group">
                        <label class="form-label" for="{{ feature }}">
                            <i class="fas fa-chart-line"></i> 
                            {{ feature.replace('_', ' ').replace(' (%)', ' (%)') }}
                            {% if feature_info[feature].optional %}
                                <span class="optional">(Optional)</span>
                            {% else %}
                                <span class="required">*</span>
                            {% endif %}
                        </label>
                        <div class="field-description">
                            {{ feature_info[feature].description }} - 
                            <strong>{{ feature_info[feature].unit }}</strong>
                            <br><small>Example: {{ feature_info[feature].example }}</small>
                        </div>
                        <input type="number" 
                               class="form-input" 
                               id="{{ feature }}" 
                               name="{{ feature }}" 
                               step="0.01" 
                               min="0"
                               max="100"
                               {% if not feature_info[feature].optional %}required{% endif %}
                               placeholder="Enter {{ feature_info[feature].example }}">
                    </div>
                    {% endfor %}
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-calculator"></i>
                        Predict Performance
                    </button>
                </form>
            </div>

            <!-- Feature Importance -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-bar"></i>
                    <h2>Model Feature Importance</h2>
                </div>
                {% if importance_plot %}
                <div class="plot-container">
                    <img src="data:image/png;base64,{{ importance_plot }}" alt="Feature Importance Plot">
                    <p style="margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                        This chart shows which factors the AI model considers most important for predicting student performance.
                    </p>
                </div>
                {% endif %}
            </div>

            {% if prediction %}
            <!-- Prediction Results -->
            <div class="card">
                <div class="prediction-result {{ category.lower().replace(' ', '-') }}">
                    <i class="fas fa-trophy"></i>
                    <div class="prediction-score">{{ prediction }}</div>
                    <div class="prediction-category">{{ category }} Performance</div>
                    <p>Predicted Total Score out of 100</p>
                </div>
                
                {% if insights %}
                <div class="insights">
                    <h3><i class="fas fa-lightbulb"></i> Key Insights</h3>
                    {% for insight in insights %}
                    <div class="insight-item">{{ insight }}</div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- SHAP Summary -->
            {% if shap_summary %}
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-microscope"></i>
                    <h2>Feature Impact Analysis</h2>
                </div>
                <div class="shap-summary">
                    <p style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                        SHAP values show how each feature pushes the prediction higher (positive) or lower (negative) from the baseline.
                    </p>
                    {% for item in shap_summary %}
                    <div class="shap-item">
                        <div class="shap-feature">
                            {{ item.feature }}: {{ item.value }}
                        </div>
                        <div class="shap-value {{ item.impact.lower() }}">
                            {{ "+" if item.shap_value > 0 else "" }}{{ item.shap_value }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if waterfall_plot %}
            <!-- SHAP Explanation -->
            <div class="explanation-section">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-project-diagram"></i>
                        <h2>Detailed Prediction Explanation</h2>
                    </div>
                    <div class="plot-container">
                        <img src="data:image/png;base64,{{ waterfall_plot }}" alt="SHAP Waterfall Plot">
                        <p style="margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                            This waterfall chart shows step-by-step how each feature contributes to the final prediction, starting from the model's baseline prediction.
                        </p>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endif %}
        </div>

        <div class="loading" id="loading">
            <i class="fas fa-spinner"></i>
            <p>Generating AI explanation...</p>
        </div>
    </div>

    <script>
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent default form submission
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            
            // Collect form data
            const formData = new FormData(this);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = parseFloat(value);
            }
            
            // Send AJAX request
            fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                
                if (result.success) {
                    // Display results
                    displayResults(result);
                } else {
                    alert('Error: ' + result.error);
                }
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                alert('Error: ' + error.message);
            });
        });

        function displayResults(result) {
            // Create results HTML
            const categoryClass = result.category.toLowerCase().replace(' ', '-');
            const resultsHTML = `
                <div class="card" id="results">
                    <div class="prediction-result ${categoryClass}">
                        <i class="fas fa-trophy"></i>
                        <div class="prediction-score">${result.prediction.toFixed(1)}</div>
                        <div class="prediction-category">
                            ${result.category} Performance
                        </div>
                        <p>Predicted Total Score out of 100</p>
                    </div>
                    
                    ${result.explanations && result.explanations.length > 0 ? `
                        <div class="insights">
                            <h3><i class="fas fa-lightbulb"></i> Key Insights</h3>
                            ${result.explanations.map(exp => `<div class="insight-item">${exp}</div>`).join('')}
                        </div>
                    ` : ''}
                    
                    ${result.feature_importance ? `
                        <div class="insights">
                            <h3><i class="fas fa-chart-bar"></i> Most Important Factors</h3>
                            ${Object.entries(result.feature_importance)
                                .sort((a, b) => b[1] - a[1])
                                .slice(0, 5)
                                .map(([feature, importance]) => 
                                    `<div class="insight-item">
                                        <strong>${feature.replace(/_/g, ' ')}</strong>: ${(importance * 100).toFixed(1)}% importance
                                    </div>`
                                ).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Remove existing results
            const existingResults = document.getElementById('results');
            if (existingResults) {
                existingResults.remove();
            }
            
            // Add new results
            const container = document.querySelector('.container');
            container.insertAdjacentHTML('beforeend', resultsHTML);
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Add some interactivity
        document.querySelectorAll('.form-input').forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.style.transform = 'scale(1.02)';
                this.parentElement.style.transition = 'transform 0.2s ease';
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.style.transform = 'scale(1)';
            });
        });
    </script>
</body>
</html>
